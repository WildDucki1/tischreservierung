<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tischreservierung</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --gold:#c9a84c; --gold-light:#e8c97a;
    --dark:#0a0a0f; --dark3:#1c1c26;
    --surface:#16161f; --border:rgba(201,168,76,0.2);
    --text:#e8e0d0; --text-dim:#7a7060;
    --green:#4caf7d; --red:#c94c4c; --amber:#c97a4c;
    --purple:#8b5cf6; --purple-light:#c084fc;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--dark);color:var(--text);font-family:'Montserrat',sans-serif;font-weight:300;min-height:100vh;overflow-x:hidden;}
  body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:0;opacity:0.5;}

  /* Banner */
  #geschlossenBanner{display:none;padding:14px 80px 14px 24px;text-align:center;position:relative;z-index:10;}
  #geschlossenBanner.active{display:block;}
  #geschlossenBanner.bald{background:linear-gradient(135deg,rgba(201,168,76,0.08),rgba(139,92,246,0.06));border-bottom:1px solid rgba(201,168,76,0.25);}
  #geschlossenBanner.jetzt{background:linear-gradient(135deg,rgba(139,92,246,0.18),rgba(201,76,76,0.1));border-bottom:1px solid rgba(139,92,246,0.4);}
  .banner-title{font-family:'Cormorant Garamond',serif;font-size:1.2rem;letter-spacing:0.15em;margin-bottom:3px;}
  .bald .banner-title{color:var(--gold-light);}
  .jetzt .banner-title{color:var(--purple-light);}
  .banner-info{font-size:0.66rem;letter-spacing:0.16em;color:var(--text-dim);text-transform:uppercase;margin-bottom:3px;}
  .banner-info span{color:var(--text);}
  .banner-timer{font-size:0.72rem;letter-spacing:0.12em;font-weight:500;}
  .bald .banner-timer{color:var(--gold);}
  .jetzt .banner-timer{color:#a78bfa;}
  .banner-aufheben{position:absolute;right:16px;top:50%;transform:translateY(-50%);background:transparent;border:1px solid rgba(139,92,246,0.35);color:#a78bfa;font-family:'Montserrat',sans-serif;font-size:0.56rem;letter-spacing:0.15em;text-transform:uppercase;padding:6px 12px;border-radius:3px;cursor:pointer;transition:all 0.2s;}
  .banner-aufheben:hover{background:rgba(139,92,246,0.15);}

  header{text-align:center;padding:48px 20px 30px;border-bottom:1px solid var(--border);}
  .logo-line{width:60px;height:1px;background:var(--gold);display:inline-block;vertical-align:middle;margin:0 18px;opacity:0.7;}
  header h1{font-family:'Cormorant Garamond',serif;font-size:clamp(2rem,5vw,3.5rem);font-weight:300;letter-spacing:0.15em;color:var(--gold-light);text-transform:uppercase;}
  header p{margin-top:8px;font-size:0.7rem;letter-spacing:0.3em;color:var(--text-dim);text-transform:uppercase;}
  .sperren-btn{display:inline-block;margin-top:16px;padding:9px 22px;background:transparent;border:1px solid rgba(139,92,246,0.4);color:#a78bfa;font-family:'Montserrat',sans-serif;font-size:0.6rem;letter-spacing:0.2em;text-transform:uppercase;border-radius:3px;cursor:pointer;transition:all 0.2s;}
  .sperren-btn:hover{background:rgba(139,92,246,0.1);border-color:rgba(139,92,246,0.7);}
  .sperren-btn.aktiv{background:rgba(139,92,246,0.15);border-color:var(--purple);color:var(--purple-light);}

  .legend{display:flex;justify-content:center;gap:20px;padding:14px;flex-wrap:wrap;}
  .legend-item{display:flex;align-items:center;gap:7px;font-size:0.63rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--text-dim);}
  .legend-dot{width:10px;height:10px;border-radius:50%;}
  .legend-dot.frei{background:var(--green);}
  .legend-dot.reserviert{background:var(--amber);}
  .legend-dot.belegt{background:var(--red);}
  .legend-dot.beide{background:linear-gradient(135deg,var(--red) 50%,var(--amber) 50%);}

  main{max-width:1200px;margin:0 auto;padding:34px 20px 80px;position:relative;z-index:1;}
  .section{margin-bottom:52px;}
  .section-header{display:flex;align-items:center;gap:20px;margin-bottom:26px;}
  .section-header h2{font-family:'Cormorant Garamond',serif;font-size:1.7rem;font-weight:300;letter-spacing:0.12em;color:var(--gold-light);white-space:nowrap;}
  .section-line{flex:1;height:1px;background:linear-gradient(to right,var(--gold),transparent);opacity:0.35;}
  .section-count{font-size:0.63rem;letter-spacing:0.2em;color:var(--text-dim);text-transform:uppercase;}

  .table-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(148px,1fr));gap:14px;}

  /* Tisch Karte */
  .table-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:17px 12px 13px;cursor:pointer;text-align:center;transition:transform 0.2s,border-color 0.25s,box-shadow 0.25s,background 0.25s;position:relative;overflow:hidden;user-select:none;}
  .table-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--green);transition:background 0.25s;}
  .table-card:hover{transform:translateY(-3px);border-color:rgba(201,168,76,0.4);box-shadow:0 8px 30px rgba(0,0,0,0.4);}
  .table-card.nur-reserviert::before{background:var(--amber);}
  .table-card.nur-reserviert{border-color:rgba(201,122,76,0.35);background:rgba(201,122,76,0.06);}
  .table-card.nur-belegt::before{background:var(--red);}
  .table-card.nur-belegt{border-color:rgba(201,76,76,0.35);background:rgba(201,76,76,0.06);}
  .table-card.beides::before{background:linear-gradient(to right,var(--red),var(--amber));}
  .table-card.beides{border-color:rgba(201,76,76,0.35);background:rgba(201,76,76,0.06);}
  .table-card.gesperrt{opacity:0.4;pointer-events:none;}
  .table-icon{font-size:1.4rem;margin-bottom:7px;display:block;filter:grayscale(0.4);transition:filter 0.2s;}
  .table-card:hover .table-icon{filter:grayscale(0);}
  .table-name{font-family:'Cormorant Garamond',serif;font-size:0.95rem;letter-spacing:0.08em;color:var(--text);margin-bottom:7px;}
  .badge-row{display:flex;flex-wrap:wrap;gap:3px;justify-content:center;margin-bottom:4px;}
  .badge{font-size:0.53rem;letter-spacing:0.08em;text-transform:uppercase;font-weight:500;padding:3px 6px;border-radius:2px;display:inline-block;}
  .badge.frei{background:rgba(76,175,125,0.15);color:var(--green);border:1px solid rgba(76,175,125,0.3);}
  .badge.belegt{background:rgba(201,76,76,0.15);color:var(--red);border:1px solid rgba(201,76,76,0.35);}
  .badge.reserviert{background:rgba(201,122,76,0.15);color:var(--amber);border:1px solid rgba(201,122,76,0.35);}
  .time-tags{display:flex;flex-wrap:wrap;gap:3px;justify-content:center;margin-top:4px;}
  .time-tag{font-size:0.56rem;padding:2px 5px;border-radius:2px;background:rgba(201,122,76,0.1);color:var(--amber);border:1px solid rgba(201,122,76,0.2);line-height:1.4;text-align:left;}
  .time-tag small{display:block;color:var(--text-dim);font-size:0.5rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:90px;}
  .card-notiz{margin-top:6px;font-size:0.55rem;color:var(--text-dim);letter-spacing:0.06em;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding:0 2px;font-style:italic;}
  .card-notiz::before{content:'üìù ';}

  /* Modal Basis */
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.82);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:100;opacity:0;pointer-events:none;transition:opacity 0.25s;}
  .modal-overlay.active{opacity:1;pointer-events:all;}
  .modal{background:var(--dark3);border:1px solid var(--border);border-radius:6px;padding:32px;width:90%;max-width:500px;transform:translateY(20px) scale(0.97);transition:transform 0.3s ease;position:relative;max-height:92vh;overflow-y:auto;}
  .modal-overlay.active .modal{transform:translateY(0) scale(1);}
  .modal h3{font-family:'Cormorant Garamond',serif;font-size:1.5rem;color:var(--gold-light);margin-bottom:3px;letter-spacing:0.1em;}
  .modal-sub{font-size:0.6rem;letter-spacing:0.22em;color:var(--text-dim);text-transform:uppercase;margin-bottom:20px;}
  .modal-label{font-size:0.63rem;letter-spacing:0.2em;color:var(--text-dim);text-transform:uppercase;margin-bottom:8px;margin-top:16px;}
  .modal-label:first-of-type{margin-top:0;}
  .modal-close{position:absolute;top:14px;right:14px;background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:1.1rem;padding:4px;transition:color 0.2s;}
  .modal-close:hover{color:var(--text);}
  .modal-actions{display:flex;gap:9px;justify-content:flex-end;margin-top:20px;}
  .btn{font-family:'Montserrat',sans-serif;font-size:0.63rem;letter-spacing:0.2em;text-transform:uppercase;padding:11px 20px;border-radius:3px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--text-dim);transition:all 0.2s;}
  .btn:hover{background:rgba(255,255,255,0.05);color:var(--text);}
  .btn.primary{background:var(--gold);border-color:var(--gold);color:#000;font-weight:500;}
  .btn.primary:hover{background:var(--gold-light);}
  .btn.danger{background:rgba(201,76,76,0.1);border-color:var(--red);color:var(--red);}
  .btn.danger:hover{background:rgba(201,76,76,0.2);}

  /* Belegt Toggle */
  .belegt-toggle{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;transition:all 0.2s;user-select:none;}
  .belegt-toggle.active{background:rgba(201,76,76,0.08);border-color:rgba(201,76,76,0.38);}
  .toggle-track{width:33px;height:18px;border-radius:9px;background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.12);position:relative;transition:all 0.25s;flex-shrink:0;}
  .toggle-track::after{content:'';position:absolute;top:2px;left:2px;width:12px;height:12px;border-radius:50%;background:var(--text-dim);transition:all 0.25s;}
  .belegt-toggle.active .toggle-track{background:rgba(201,76,76,0.25);border-color:var(--red);}
  .belegt-toggle.active .toggle-track::after{transform:translateX(15px);background:var(--red);}
  .toggle-label{font-size:0.68rem;letter-spacing:0.14em;text-transform:uppercase;color:var(--text-dim);transition:color 0.2s;}
  .belegt-toggle.active .toggle-label{color:var(--red);}

  /* Zeit Grid */
  .zeit-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:5px;margin-bottom:10px;}
  .zeit-btn{background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:7px 2px;cursor:pointer;font-family:'Montserrat',sans-serif;font-size:0.6rem;letter-spacing:0.03em;color:var(--text-dim);transition:all 0.18s;text-align:center;}
  .zeit-btn:hover{border-color:rgba(201,168,76,0.4);color:var(--text);}
  .zeit-btn.selected{background:rgba(201,122,76,0.18);border-color:var(--amber);color:var(--amber);font-weight:500;}

  /* Reservierungen Liste */
  .res-liste{display:flex;flex-direction:column;gap:5px;}
  .res-item{display:flex;align-items:center;gap:8px;background:rgba(201,122,76,0.07);border:1px solid rgba(201,122,76,0.18);border-radius:3px;padding:7px 10px;}
  .res-zeit{font-size:0.7rem;color:var(--amber);font-weight:500;letter-spacing:0.08em;min-width:44px;}
  .res-name{font-size:0.72rem;color:var(--text);flex:1;}
  .res-del{background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:0.85rem;padding:1px 3px;transition:color 0.2s;line-height:1;}
  .res-del:hover{color:var(--red);}
  .keine-res{font-size:0.62rem;color:var(--text-dim);font-style:italic;padding:3px 0;}

  /* Notizen Feld */
  .notiz-textarea{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:11px 13px;color:var(--text);font-family:'Montserrat',sans-serif;font-size:0.78rem;outline:none;transition:border-color 0.2s;resize:vertical;min-height:70px;line-height:1.6;}
  .notiz-textarea:focus{border-color:rgba(201,168,76,0.4);}
  .notiz-textarea::placeholder{color:var(--text-dim);}

  /* Name Popup */
  .name-popup{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.65);z-index:200;align-items:center;justify-content:center;}
  .name-popup.active{display:flex;}
  .name-popup-box{background:var(--dark3);border:1px solid rgba(201,168,76,0.28);border-radius:6px;padding:26px;width:90%;max-width:310px;text-align:center;}
  .name-popup-box h4{font-family:'Cormorant Garamond',serif;font-size:1.25rem;color:var(--gold-light);margin-bottom:3px;letter-spacing:0.1em;}
  .name-popup-box p{font-size:0.6rem;letter-spacing:0.16em;color:var(--text-dim);text-transform:uppercase;margin-bottom:14px;}
  .name-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:11px 13px;color:var(--text);font-family:'Montserrat',sans-serif;font-size:0.85rem;outline:none;transition:border-color 0.2s;margin-bottom:13px;}
  .name-input:focus{border-color:rgba(201,168,76,0.5);}
  .name-input::placeholder{color:var(--text-dim);}
  .name-popup-actions{display:flex;gap:8px;justify-content:center;}

  /* Sperren Modal */
  #sperrenModal{border-color:rgba(139,92,246,0.22);}
  #sperrenModal h3{color:var(--purple-light);}
  .stunden-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;}
  .stunden-btn{background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:9px 4px;cursor:pointer;font-family:'Montserrat',sans-serif;font-size:0.65rem;letter-spacing:0.05em;color:var(--text-dim);transition:all 0.2s;text-align:center;}
  .stunden-btn:hover{border-color:rgba(139,92,246,0.4);color:var(--text);}
  .stunden-btn.selected{background:rgba(139,92,246,0.17);border-color:var(--purple);color:var(--purple-light);font-weight:500;}
  .time-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .field-label{font-size:0.58rem;letter-spacing:0.18em;color:var(--text-dim);text-transform:uppercase;margin-bottom:5px;}
  .time-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:11px 12px;color:var(--text);font-family:'Montserrat',sans-serif;font-size:0.8rem;outline:none;transition:border-color 0.2s;color-scheme:dark;}
  .time-input:focus{border-color:rgba(139,92,246,0.5);}
  .grund-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:11px 13px;color:var(--text);font-family:'Montserrat',sans-serif;font-size:0.8rem;outline:none;transition:border-color 0.2s;resize:none;}
  .grund-input:focus{border-color:rgba(139,92,246,0.5);}
  .grund-input::placeholder,.time-input::placeholder{color:var(--text-dim);}

  footer{text-align:center;padding:24px;font-size:0.58rem;letter-spacing:0.2em;color:var(--text-dim);text-transform:uppercase;border-top:1px solid var(--border);}

  /* Login */
  #loginScreen{position:fixed;inset:0;background:var(--dark);z-index:999;display:flex;align-items:center;justify-content:center;}
  #loginScreen.hidden{display:none;}
  .login-box{background:var(--dark3);border:1px solid var(--border);border-radius:8px;padding:46px 40px;width:90%;max-width:370px;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,0.6);}
  .login-logo{font-family:'Cormorant Garamond',serif;font-size:1.9rem;color:var(--gold-light);letter-spacing:0.15em;margin-bottom:4px;}
  .login-sub{font-size:0.58rem;letter-spacing:0.3em;color:var(--text-dim);text-transform:uppercase;margin-bottom:30px;}
  .login-divider{width:36px;height:1px;background:var(--gold);opacity:0.5;margin:0 auto 30px;}
  .login-field{margin-bottom:13px;text-align:left;}
  .login-field label{display:block;font-size:0.58rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--text-dim);margin-bottom:6px;}
  .login-field input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:3px;padding:12px 13px;color:var(--text);font-family:'Montserrat',sans-serif;font-size:0.85rem;outline:none;transition:border-color 0.2s;}
  .login-field input:focus{border-color:rgba(201,168,76,0.5);}
  .login-btn{width:100%;margin-top:20px;padding:13px;background:var(--gold);border:none;border-radius:3px;color:#000;font-family:'Montserrat',sans-serif;font-size:0.68rem;font-weight:500;letter-spacing:0.25em;text-transform:uppercase;cursor:pointer;transition:background 0.2s;}
  .login-btn:hover{background:var(--gold-light);}
  .login-error{margin-top:11px;font-size:0.63rem;letter-spacing:0.1em;color:var(--red);min-height:16px;}
  .logout-btn{position:fixed;top:15px;right:20px;z-index:50;background:transparent;border:1px solid var(--border);color:var(--text-dim);font-family:'Montserrat',sans-serif;font-size:0.58rem;letter-spacing:0.2em;text-transform:uppercase;padding:7px 13px;border-radius:3px;cursor:pointer;transition:all 0.2s;}
  .logout-btn:hover{color:var(--text);border-color:rgba(201,168,76,0.4);}
  @keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
  @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)}}
</style>
</head>
<body>

<!-- Login -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">Reservierung</div>
    <div class="login-sub">Mitarbeiter-Zugang</div>
    <div class="login-divider"></div>
    <div class="login-field">
      <label>Benutzername</label>
      <input type="text" id="loginUser" placeholder="Benutzername" autocomplete="username"
        onkeydown="if(event.key==='Enter') document.getElementById('loginPass').focus()" />
    </div>
    <div class="login-field">
      <label>Passwort</label>
      <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"
        onkeydown="if(event.key==='Enter') doLogin()" />
    </div>
    <button class="login-btn" onclick="doLogin()">Anmelden</button>
    <div class="login-error" id="loginError"></div>
  </div>
</div>
<button class="logout-btn" id="logoutBtn" style="display:none" onclick="doLogout()">‚éã Abmelden</button>

<!-- Banner -->
<div id="geschlossenBanner">
  <div class="banner-title" id="bannerTitle"></div>
  <div class="banner-info">Grund: <span id="bannerGrund"></span></div>
  <div class="banner-timer" id="bannerTimer"></div>
  <button class="banner-aufheben" onclick="sperrungAufheben()">Aufheben</button>
</div>

<header>
  <div>
    <span class="logo-line"></span>
    <h1>Tischreservierung</h1>
    <span class="logo-line"></span>
  </div>
  <p>W√§hlen Sie einen Tisch und legen Sie dessen Status fest</p>
  <button class="sperren-btn" id="sperrenBtn" onclick="openSperrenModal()">üîí Laden sperren / planen</button>
</header>

<div class="legend">
  <div class="legend-item"><span class="legend-dot frei"></span>Frei</div>
  <div class="legend-item"><span class="legend-dot reserviert"></span>Reserviert</div>
  <div class="legend-item"><span class="legend-dot belegt"></span>Belegt</div>
  <div class="legend-item"><span class="legend-dot beide"></span>Belegt + Reserviert</div>
</div>

<main id="app"></main>
<footer>Klicken Sie auf einen Tisch, um den Status zu √§ndern</footer>

<!-- ‚îÄ‚îÄ TISCH MODAL ‚îÄ‚îÄ -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h3 id="modalTitle"></h3>
    <div class="modal-sub" id="modalSection"></div>

    <div class="modal-label">Tisch ist gerade belegt</div>
    <div class="belegt-toggle" id="belegtToggle" onclick="toggleBelegt()">
      <div class="toggle-track"></div>
      <span class="toggle-label">Belegt</span>
    </div>

    <div class="modal-label">Reservierungen ‚Äî Uhrzeit ausw√§hlen</div>
    <div class="zeit-grid" id="zeitGrid"></div>
    <div class="res-liste" id="resListe"></div>

    <div class="modal-label">üìù Notizen / Bestellungen</div>
    <textarea class="notiz-textarea" id="notizInput" placeholder="z.B. 2x Steak medium, 1x veggie, Geburtstagstorte um 20:00 ..."></textarea>

    <div class="modal-actions">
      <button class="btn" onclick="closeModal()">Abbrechen</button>
      <button class="btn primary" onclick="applyStatus()">Speichern</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ NAME POPUP ‚îÄ‚îÄ -->
<div class="name-popup" id="namePopup">
  <div class="name-popup-box">
    <h4 id="namePopupTitle"></h4>
    <p>Name f√ºr die Reservierung</p>
    <input type="text" class="name-input" id="nameInput" placeholder="Name eingeben..." maxlength="40"
      onkeydown="if(event.key==='Enter') confirmName(); if(event.key==='Escape') cancelName();" />
    <div class="name-popup-actions">
      <button class="btn" onclick="cancelName()">Abbrechen</button>
      <button class="btn primary" onclick="confirmName()">Hinzuf√ºgen</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ SPERREN MODAL ‚îÄ‚îÄ -->
<div class="modal-overlay" id="sperrenOverlay">
  <div class="modal" id="sperrenModal">
    <button class="modal-close" onclick="closeSperrenModal()">‚úï</button>
    <h3>üîí Laden Sperren</h3>
    <div class="modal-sub">Tische werden gesperrt ‚Äî keine √Ñnderungen m√∂glich</div>

    <div class="modal-label">Startzeitpunkt</div>
    <div class="time-row">
      <div>
        <div class="field-label">Datum</div>
        <input type="date" class="time-input" id="sperrenDatum" />
      </div>
      <div>
        <div class="field-label">Uhrzeit</div>
        <input type="time" class="time-input" id="sperrenUhrzeit" />
      </div>
    </div>

    <div class="modal-label" style="margin-top:16px;">Dauer</div>
    <div class="stunden-grid" id="stundenGrid"></div>

    <div class="modal-label" style="margin-top:16px;">Grund</div>
    <textarea class="grund-input" id="grundInput" rows="2" placeholder="z.B. Firmenfeier, Privatveranstaltung, Reinigung..."></textarea>

    <div class="modal-actions">
      <button class="btn" onclick="closeSperrenModal()">Abbrechen</button>
      <button class="btn danger" onclick="ladenSperren()">üîí Einplanen</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAODdATV3lEjzvlLHdBluSh4DdFL2Og5Lc",
  authDomain: "tischreservirung.firebaseapp.com",
  projectId: "tischreservirung",
  storageBucket: "tischreservirung.firebasestorage.app",
  messagingSenderId: "1053055806378",
  appId: "1:1053055806378:web:ea2cafa6e6134bde6e99d3",
  databaseURL: "https://tischreservirung-default-rtdb.europe-west1.firebasedatabase.app"
};
const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

const sections = [
  { id:'terrasse', name:'Terrasse',      icon:'üåø', tables: Array.from({length:11},(_,i)=>({id:`t${i+1}`,name:`Tisch ${i+1}`})) },
  { id:'captain',  name:'Captain Lounge',icon:'‚öì', tables: Array.from({length:4}, (_,i)=>({id:`c${i+1}`,name:`Tisch ${i+1}`})) },
  { id:'eclipse',  name:'Eclipse Lounge',icon:'üåô', tables: Array.from({length:5}, (_,i)=>({id:`e${i+1}`,name:`Tisch ${i+1}`})) }
];

const ZEITEN  = Array.from({length:24},(_,i)=>`${String(i).padStart(2,'0')}:00`);
const STUNDEN = [0.5,1,1.5,2,2.5,3,4,5,6,8,10,12];

let liveData    = {};
let sperrung    = null;
let timerIntv   = null;
let istGesperrt = false;

// Modal state
let currentTableId = null;
let editBelegt     = false;
let editZeiten     = [];
let pendingZeit    = null;
let editStunden    = null;

function dataOf(id){ return liveData[id]||{belegt:false,zeiten:[],notiz:''}; }
function getTableMeta(id){ for(const s of sections) for(const t of s.tables) if(t.id===id) return t; }
function getSectionOf(id){ for(const s of sections) for(const t of s.tables) if(t.id===id) return s; }

function cardClass(id){
  const d=dataOf(id); const hz=d.zeiten&&d.zeiten.length>0;
  if(d.belegt&&hz) return 'beides';
  if(d.belegt)     return 'nur-belegt';
  if(hz)           return 'nur-reserviert';
  return '';
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RENDER ‚Äî nur einzelne Karte updaten (kein Flackern!)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function cardHTML(t){
  const d=dataOf(t.id), cls=cardClass(t.id);
  const hz=d.zeiten&&d.zeiten.length>0;
  const sorted=hz?[...d.zeiten].sort((a,b)=>a.zeit.localeCompare(b.zeit)):[];
  const gesperrtClass=istGesperrt?' gesperrt':'';
  return `<span class="table-icon">ü™ë</span>
    <div class="table-name">${t.name}</div>
    <div class="badge-row">
      ${d.belegt?`<span class="badge belegt">Belegt</span>`:''}
      ${hz?`<span class="badge reserviert">Reserviert</span>`:''}
      ${!d.belegt&&!hz?`<span class="badge frei">Frei</span>`:''}
    </div>
    ${hz?`<div class="time-tags">${sorted.map(r=>`<span class="time-tag">${r.zeit}<small>${r.name||''}</small></span>`).join('')}</div>`:''}
    ${d.notiz?`<div class="card-notiz">${d.notiz}</div>`:''}
    <span data-cls="${cls}${gesperrtClass}" style="display:none"></span>`;
}

function initialRender(){
  document.getElementById('app').innerHTML = sections.map(sec=>`
    <div class="section" id="sec-${sec.id}">
      <div class="section-header">
        <h2>${sec.icon} ${sec.name}</h2>
        <div class="section-line"></div>
        <div class="section-count">${sec.tables.length} Tische</div>
      </div>
      <div class="table-grid">
        ${sec.tables.map(t=>`
          <div class="table-card" id="card-${t.id}" onclick="window._openModal('${t.id}')">${cardHTML(t)}</div>
        `).join('')}
      </div>
    </div>`).join('');
}

// Nur ge√§nderte Karten updaten ‚Äî kein Flackern
function smartUpdate(){
  for(const sec of sections){
    for(const t of sec.tables){
      const el=document.getElementById(`card-${t.id}`);
      if(!el) continue;
      const d=dataOf(t.id);
      const cls=cardClass(t.id);
      const gesperrtClass=istGesperrt?' gesperrt':'';
      const newClass=`table-card${cls?' '+cls:''}${gesperrtClass}`;
      // Klasse updaten
      if(el.className!==newClass) el.className=newClass;
      // Inhalt updaten ‚Äî nur wenn sich Daten ge√§ndert haben
      const sig=JSON.stringify({belegt:d.belegt,zeiten:d.zeiten,notiz:d.notiz,g:istGesperrt});
      if(el.dataset.sig!==sig){
        el.dataset.sig=sig;
        el.innerHTML=cardHTML(t);
        // onclick neu setzen (innerHTML l√∂scht event listener nicht bei onclick-attr)
      }
    }
  }
}

// ‚îÄ‚îÄ FIREBASE ‚îÄ‚îÄ
onValue(ref(db,'tische'), snap=>{
  liveData=snap.val()||{};
  if(document.getElementById('card-t1')) smartUpdate();
  else { initialRender(); }
});

onValue(ref(db,'sperrung'), snap=>{
  sperrung=snap.val();
  updateSperrungUI();
});

// ‚îÄ‚îÄ SPERRUNG UI ‚Äî ber√ºhrt die Tischkarten NICHT direkt ‚îÄ‚îÄ
function updateSperrungUI(){
  const banner=document.getElementById('geschlossenBanner');
  const btn=document.getElementById('sperrenBtn');
  clearInterval(timerIntv);
  const now=Date.now();
  const altGesperrt=istGesperrt;

  if(sperrung && sperrung.bis>now){
    banner.classList.add('active');
    if(sperrung.von<=now){
      istGesperrt=true;
      banner.className='active jetzt';
      document.getElementById('bannerTitle').textContent='üîí Gesamter Laden Gesperrt';
      btn.classList.add('aktiv'); btn.textContent='‚úì Laden gesperrt';
    } else {
      istGesperrt=false;
      banner.className='active bald';
      const vonStr=new Date(sperrung.von).toLocaleTimeString('de-DE',{hour:'2-digit',minute:'2-digit'});
      document.getElementById('bannerTitle').textContent=`‚è≥ Sperrung geplant ab ${vonStr} Uhr`;
      btn.classList.add('aktiv'); btn.textContent='‚úì Sperrung geplant';
    }
    document.getElementById('bannerGrund').textContent=sperrung.grund||'‚Äî';
    tickTimer();
    timerIntv=setInterval(()=>{
      const n=Date.now();
      if(sperrung.bis<=n){ sperrungAufheben(); return; }
      // Wechsel von "geplant" ‚Üí "aktiv"
      if(!istGesperrt && sperrung.von<=n){
        istGesperrt=true;
        updateSperrungUI();
      } else { tickTimer(); }
    },1000);
  } else {
    istGesperrt=false;
    banner.classList.remove('active');
    btn.classList.remove('aktiv');
    btn.textContent='üîí Laden sperren / planen';
  }

  // Nur wenn sich Sperr-Status ge√§ndert hat ‚Üí Karten updaten
  if(altGesperrt!==istGesperrt) smartUpdate();
}

function tickTimer(){
  if(!sperrung) return;
  const now=Date.now();
  let rest, prefix;
  if(sperrung.von>now){ rest=sperrung.von-now; prefix='Startet in: '; }
  else { rest=Math.max(0,sperrung.bis-now); prefix='Noch: '; }
  const h=Math.floor(rest/3600000), m=Math.floor((rest%3600000)/60000), s=Math.floor((rest%60000)/1000);
  document.getElementById('bannerTimer').textContent=`${prefix}${h>0?h+'h ':''} ${m}min ${s}s`;
}

window.sperrungAufheben=function(){ set(ref(db,'sperrung'),null); };

// ‚îÄ‚îÄ SPERREN MODAL ‚îÄ‚îÄ
const stundenGrid=document.getElementById('stundenGrid');
STUNDEN.forEach(h=>{
  const btn=document.createElement('button');
  btn.className='stunden-btn'; btn.dataset.h=h;
  btn.textContent=h<1?`${h*60} Min`:`${h} Std`;
  btn.onclick=()=>{ editStunden=h; document.querySelectorAll('.stunden-btn').forEach(b=>b.classList.toggle('selected',b===btn)); };
  stundenGrid.appendChild(btn);
});

window.openSperrenModal=function(){
  if(sperrung&&sperrung.bis>Date.now()){ if(confirm('Sperrung aufheben?')) sperrungAufheben(); return; }
  editStunden=null;
  document.getElementById('grundInput').value='';
  document.querySelectorAll('.stunden-btn').forEach(b=>b.classList.remove('selected'));
  const now=new Date(), pad=n=>String(n).padStart(2,'0');
  document.getElementById('sperrenDatum').value=`${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
  document.getElementById('sperrenUhrzeit').value=`${pad(now.getHours())}:${pad(now.getMinutes())}`;
  document.getElementById('sperrenOverlay').classList.add('active');
};
window.closeSperrenModal=function(){ document.getElementById('sperrenOverlay').classList.remove('active'); };
window.ladenSperren=function(){
  if(!editStunden){ alert('Bitte eine Dauer ausw√§hlen!'); return; }
  const datum=document.getElementById('sperrenDatum').value;
  const uhrzeit=document.getElementById('sperrenUhrzeit').value;
  if(!datum||!uhrzeit){ alert('Bitte Datum und Uhrzeit eingeben!'); return; }
  const von=new Date(`${datum}T${uhrzeit}`).getTime();
  const bis=von+editStunden*3600000;
  set(ref(db,'sperrung'),{grund:document.getElementById('grundInput').value.trim()||'Kein Grund angegeben',von,bis});
  closeSperrenModal();
};
document.getElementById('sperrenOverlay').addEventListener('click',function(e){if(e.target===this)closeSperrenModal();});

// ‚îÄ‚îÄ TISCH MODAL ‚îÄ‚îÄ
const zeitGrid=document.getElementById('zeitGrid');
ZEITEN.forEach(z=>{
  const btn=document.createElement('button');
  btn.className='zeit-btn'; btn.dataset.zeit=z; btn.textContent=z;
  btn.onclick=()=>zeitKlick(z);
  zeitGrid.appendChild(btn);
});

function zeitKlick(zeit){
  const idx=editZeiten.findIndex(r=>r.zeit===zeit);
  if(idx!==-1){ editZeiten.splice(idx,1); updateZeitUI(); return; }
  pendingZeit=zeit;
  document.getElementById('namePopupTitle').textContent=`${zeit} Uhr`;
  document.getElementById('nameInput').value='';
  document.getElementById('namePopup').classList.add('active');
  setTimeout(()=>document.getElementById('nameInput').focus(),80);
}

window.confirmName=function(){
  const name=document.getElementById('nameInput').value.trim();
  if(!name){ document.getElementById('nameInput').focus(); return; }
  if(pendingZeit){ editZeiten.push({zeit:pendingZeit,name}); editZeiten.sort((a,b)=>a.zeit.localeCompare(b.zeit)); }
  document.getElementById('namePopup').classList.remove('active');
  pendingZeit=null;
  updateZeitUI();
};
window.cancelName=function(){ document.getElementById('namePopup').classList.remove('active'); pendingZeit=null; };

function updateZeitUI(){
  const sel=editZeiten.map(r=>r.zeit);
  document.querySelectorAll('.zeit-btn').forEach(btn=>btn.classList.toggle('selected',sel.includes(btn.dataset.zeit)));
  const liste=document.getElementById('resListe');
  liste.innerHTML=editZeiten.length===0
    ?'<div class="keine-res">Keine Reservierungen</div>'
    :editZeiten.map((r,i)=>`
      <div class="res-item">
        <span class="res-zeit">${r.zeit}</span>
        <span class="res-name">${r.name}</span>
        <button class="res-del" onclick="delRes(${i})">‚úï</button>
      </div>`).join('');
}

window.delRes=function(i){ editZeiten.splice(i,1); updateZeitUI(); };

window._openModal=function(tableId){
  if(istGesperrt) return;
  currentTableId=tableId;
  const d=dataOf(tableId);
  editBelegt=d.belegt||false;
  editZeiten=d.zeiten?d.zeiten.map(r=>({...r})):[];
  document.getElementById('modalTitle').textContent=getTableMeta(tableId).name;
  document.getElementById('modalSection').textContent=getSectionOf(tableId).name;
  document.getElementById('belegtToggle').classList.toggle('active',editBelegt);
  document.getElementById('notizInput').value=d.notiz||'';
  updateZeitUI();
  document.getElementById('modalOverlay').classList.add('active');
};
window.closeModal=function(){
  document.getElementById('modalOverlay').classList.remove('active');
  currentTableId=null;
};
window.toggleBelegt=function(){
  editBelegt=!editBelegt;
  document.getElementById('belegtToggle').classList.toggle('active',editBelegt);
};
window.applyStatus=function(){
  if(!currentTableId) return;
  const notiz=document.getElementById('notizInput').value.trim();
  set(ref(db,`tische/${currentTableId}`),{
    belegt:editBelegt,
    zeiten:editZeiten.length>0?editZeiten:[],
    notiz:notiz||''
  });
  closeModal();
};
document.getElementById('modalOverlay').addEventListener('click',function(e){if(e.target===this)closeModal();});

// ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ
const ACCOUNTS=[{user:'admin',pass:'admin123'},{user:'kollege',pass:'lounge2024'}];
window.doLogin=function(){
  const user=document.getElementById('loginUser').value.trim();
  const pass=document.getElementById('loginPass').value;
  const match=ACCOUNTS.find(a=>a.user===user&&a.pass===pass);
  if(match){
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('logoutBtn').style.display='block';
    document.getElementById('loginError').textContent='';
  } else {
    document.getElementById('loginError').textContent='Falscher Benutzername oder Passwort.';
    document.getElementById('loginPass').value='';
    document.getElementById('loginPass').focus();
    const box=document.querySelector('.login-box');
    box.style.animation='none'; void box.offsetHeight;
    box.style.animation='shake 0.35s ease';
  }
};
window.doLogout=function(){
  document.getElementById('loginScreen').classList.remove('hidden');
  document.getElementById('logoutBtn').style.display='none';
  document.getElementById('loginUser').value='';
  document.getElementById('loginPass').value='';
  document.getElementById('loginError').textContent='';
};
</script>
</body>
</html>